# Landlab Overland Flow Simulation

This document describes how to set up and run the `overland_flow_simulation.py` script.
The script simulates simple overland flow on a generated terrain using the Landlab toolkit.
You can run this simulation either using Docker (recommended for consistency and ease of setup) or locally using `uv`.

## Prerequisites

1.  **Python:** (For local development without Docker) Ensure you have Python installed (Python 3.8 or newer is recommended).
2.  **`uv`:** (For local development without Docker) A fast Python package installer. See installation instructions below.
3.  **Docker & Docker Compose:** (For Docker setup) Ensure Docker and Docker Compose are installed on your system.
    *   [Install Docker Engine](https://docs.docker.com/engine/install/)
    *   [Install Docker Compose](https://docs.docker.com/compose/install/)

## Option 1: Running with Docker (Recommended)

This method uses Docker to create a consistent environment for running the simulation. Plots generated by the simulation will be saved to an `output_plots` directory on your host machine.

1.  **Ensure Files are Present:**
    Make sure you have the following files in your project directory:
    *   `overland_flow_simulation.py` (the version modified to save plots)
    *   `pyproject.toml`
    *   `Dockerfile`
    *   `docker-compose.yml`
    *   `Makefile` (optional, but provides convenient commands)

2.  **Build the Docker Image:**
    Open your terminal in the project directory and run:
    ```bash
    make build
    ```
    Alternatively, without `make`:
    ```bash
    docker compose build
    ```

3.  **Run the Simulation:**
    To run the simulation:
    ```bash
    make run
    ```
    Alternatively, without `make`:
    ```bash
    docker compose up
    ```
    This will start the simulation. You'll see console output, and upon completion, plot images (e.g., `water_depth_simtime600s.png`, `final_topography.png`) will be saved in the `./output_plots` directory on your host machine.

4.  **Accessing a Shell inside the Container (for debugging/exploration):**
    ```bash
    make shell
    ```
    Alternatively, without `make`:
    ```bash
    docker compose run --rm app bash
    ```

5.  **Cleaning Up:**
    *   To remove the generated plots:
        ```bash
        make clean-output
        ```
    *   To stop and remove the Docker containers, networks, and volumes defined in `docker-compose.yml`:
        ```bash
        make down
        ```
    *   To do both:
        ```bash
        make clean
        ```

### Note on Interactive Plots with Docker (Advanced)

The provided Docker setup uses the `Agg` backend for Matplotlib, which is non-interactive and saves plots to files. If you need to display plots interactively from within the Docker container (e.g., for debugging), you would typically need to:
1.  Modify the `Dockerfile` to install necessary X11 client libraries (e.g., `python3-tk` or `python3-qt5`) and potentially remove/override `ENV MPLBACKEND="Agg"`.
2.  Configure X11 forwarding when running the container (e.g., by setting the `DISPLAY` environment variable and mounting `/tmp/.X11-unix`). This can be complex and platform-dependent.
For most use cases, saving plots to files is more straightforward with Docker.

## Option 2: Local Development Setup (without Docker)

This section describes how to set up and run the script directly on your machine using `uv`.

1.  **Navigate to your Project Directory:**
    Open your terminal or command prompt and change to the directory where `overland_flow_simulation.py` and `pyproject.toml` are located.

2.  **Install `uv` (if not already installed):**
    ```bash
    # Using pipx (recommended)
    pipx install uv
    # Or using pip
    pip install uv
    ```

3.  **Create and Activate a Virtual Environment with `uv`:**
    ```bash
    uv venv
    source .venv/bin/activate  # On macOS/Linux
    # .venv\Scripts\activate.bat  # On Windows CMD
    # .venv\Scripts\Activate.ps1 # On Windows PowerShell
    ```

4.  **Install Dependencies with `uv`:**
    Dependencies are defined in `pyproject.toml`. You can install them using:
    ```bash
    uv pip install -e .
    ```
    This installs the project and its dependencies. Alternatively, to just install dependencies:
    ```bash
    uv pip install landlab numpy matplotlib
    ```

5.  **Run the Simulation Script:**
    ```bash
    python overland_flow_simulation.py
    ```
    If running locally and you haven't modified the script to save plots (i.e., it still uses `plt.show()`), Matplotlib windows will appear. If you are using the modified script that saves plots, they will appear in the `output_plots` directory.

## Expected Output (from script logic)

1.  **Console Output:**
    *   Messages like "Starting simulation..."
    *   Periodic updates showing the elapsed simulation time and plotting actions.
    *   A final "Simulation finished." message.
    *   Messages indicating where plots are saved (e.g., "Saved plot: output_plots/water_depth_simtime600s.png").

2.  **Saved Plot Files (in `output_plots` directory):**
    *   Image files for "Water Depth (m)" at different time intervals.
    *   An image file for the "Final Topography".